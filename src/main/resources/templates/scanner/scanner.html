<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/head :: baseHead(~{::title}, ~{::link}, ~{::script})">
    <meta charset="UTF-8">
    <title>Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
</head>
<body>

<header th:replace="fragments/header"></header>
<div class="container mt-5">
    <div class="row ">
        <div class="col-md-4 margin-auto text-center divcontenedorVideo">
            <div class="text-center"id="contenedorVideo"></div>
        </div>
        <div class="col-md-4 text-center ">
            <div class="col-md-12 ajuste">
                <button class="btn col-md-12 mt-5 mb-4 naranja-blanco disabled" disabled id="cambiaravideo"><span class="fas fa-arrow-circle-left"></span> Video en tiempo real</button>
            </div>
            <div class="col-md-12 ajuste">
                <a href="/scanner/scannerdos"><button class="btn col-md-12 mt-5 mb-4 naranja-blanco"  id="cambiaraimagen">Adjunar imagen <span class="fas fa-arrow-circle-right"></span></button></a>
            </div>
        </div>
        <div id="avatarImage" class="col-md-4 margin-auto text-center ">
            <div class="col-md-12 text-center vertical-center"><img id="imagenn" class="bordes-adjun" src="/static/imagenes/adjun.png" width="374" height="234"></div>
        </div>
    </div>
</div>
    <div class="row mt-2 centrarvideo text-center">
        <div class="col-md-12 mt-2 mb-4 text-center">
            <span class="col-md-12 " id="result"></span>
        </div>
    </div>
    <div class="row centrarbotones">
            <div class="col-md-4 mb-2">
                <button class="btn col-md-12 verde-blanco" id="botonPredecir">Iniciar</button>
            </div>
            <div class="col-md-4 mb-2">
                <button class="btn col-md-12 verde-blanco" onclick="masInfo()" id="info">Mas Informaci√≥n</button>
            </div>
            <div class="col-md-4 mb-2">
                <button class="btn col-md-12 verde-blanco mb-5" onclick="verMapa()" id="mapita">Ver Mapa</button>
            </div>
    </div>
<script th:inline="javascript">
    let video;
    let featureExtractor;
    let clasificador;
    let categorias;
    let cate;
    let info;
    function setup() {
        noCanvas();
        video = createCapture(VIDEO);
        video.size(320,240);
        video.parent('contenedorVideo');
        featureExtractor = ml5.featureExtractor('MobileNet',modelReady);
        clasificador = featureExtractor.classification(video);
        configuraBotones();

    }
    function configuraBotones() {

        let botonPredecir = select('#botonPredecir');
        botonPredecir.mousePressed(function () {
            clasificador.train();
            clasificador.classify(muestraResultado);
        });
    }

    function muestraResultado(err, res) {
        clasificador.classify(muestraResultado);
        /*<![CDATA[*/
        var myVariable= /*[[${categorias}]]*/ 'value';
        /*]]>*/
        if (res[0].confidence > 0.75) {
            myVariable.forEach(function (value) {
                if (res[0].label == value.imagen){
                cate = value.categoria.nombre;
                    info=value.categoria;
                    select("#result").html(cate);
                }
            });
        }else{}
    }
    function modelReady() {
        clasificador.load('https://cdn.jsdelivr.net/gh/Nicolasemanuelmorales/prueba/mvp1.json');
    }
    function masInfo() {
        if(info == null){}
        else{window.location.replace("/categoria/"+info.id);}
    }
    function verMapa() {
        if(info == null){}
        else{window.location.replace("/map?categories=" + info.nombre.toUpperCase());}
    }

</script>
<footer th:replace="fragments/footer"></footer>
</body>
</html>
