<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/head :: baseHead(~{::title}, ~{::link}, ~{::script})">
    <meta charset="UTF-8">
    <title>Scanner</title>
    <link rel="stylesheet" th:href="@{/css/scanner.css}">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
</head>
<body>

<header th:replace="fragments/header"></header>
<div class="container mt-5">
    <div class="row ">
        <div class="col-md-4 margin-auto" style="background: black; ">
            <div class="text-center" style="" id="contenedorVideo"></div>
        </div>

        <div onclick="cargarImagen()" id="avatarImage" class="col-md-4 margin-auto" style="background: #E4E4E4; width: 320px;height: 240px;border: dashed 3px #C6C6C6;">
            <div style="margin-top: 23%;" class="col-md-12 text-center vertical-center"><span class="fa fa-plus"  style="font-size: 80px;color: #6e6e6e;"></span></div>
        </div>
    </div>
</div>

<br>
<div style="width: 40%; height: 300px;margin: 0 auto;">
    <div class="row col-md-12 justify-content-md-center">
        <div class="col-md-8 text-center mt-2 mb-4" >
            <span style="font: bold 20px Araial; color: #3B6E36;" id="result"></span>
        </div>
        <div class="col-md-5 text-center" style="margin-left: 1%;">
            <button class="btn col-md-12" style="background: #3B6E36!important;color: white;" id="botonPredecir">Iniciar</button>
        </div>
        <div class="col-md-5 text-center" style="margin-left: 1%;">
            <button onclick="masInfo()" class="btn col-md-12" style="background: darkorange!important;color: white;" id="info">Mas Información.</button>
        </div>
    </div>

</div>
<input type="file" hidden name="imagen" id="avatarInput" />
<script th:inline="javascript">
    let video;
    let featureExtractor;
    let clasificador;
    let categorias;
    let cate
    function setup() {
        noCanvas();
        video = createCapture(VIDEO);
        video.size(320,240);
        video.parent('contenedorVideo');
        featureExtractor = ml5.featureExtractor('MobileNet',modelReady);
        clasificador = featureExtractor.classification(video);
        configuraBotones();

    }
    function configuraBotones() {

        let botonPredecir = select('#botonPredecir');
        botonPredecir.mousePressed(function () {
            clasificador.train();
            clasificador.classify(muestraResultado);
        });
    }

    function muestraResultado(err, res) {
        clasificador.classify(muestraResultado);
        /*<![CDATA[*/
        var myVariable= /*[[${categorias}]]*/ 'value';
        /*]]>*/
        if (res[0].confidence > 0.75) {
            myVariable.forEach(function (value) {
                if (res[0].label == value.imagen){
                cate = value.categoria.nombre;
                select("#result").html(cate);
                }
            });
        }else{}
    }
    function modelReady() {
        clasificador.load('https://cdn.jsdelivr.net/gh/Nicolasemanuelmorales/prueba/mvp1.json');
    }

    function masInfo() {
        if(cate == null)
        {
        }
        else
        {
            window.location.replace("masinfo/"+cate);
        }
    }
    $(document).ready(function () {
        var $avatarInput, $avatarImage;
        $(function () {
            $avatarInput = $('#avatarInput');
            $avatarImage = $('#avatarImage');
            $avatarImage.on('click', function () {
                $avatarInput.click();
            })
        })
    });
</script>
<footer class="page-footer font-small indigo mt-5" style="background:#3D3D3D;border-top: solid 0.0px darkorange;">
    <div class="container">
        <div class="row text-center d-flex justify-content-center pt-5 mb-3">
            <div class="col-md-2 mb-3 text-center">
                <h6 class="text-uppercase font-weight-bold">
                    <a href="#!"><span style="color: white!important;">HOME</span></a>
                </h6>
            </div>
            <div class="col-md-2 mb-3 text-center">
                <h6 class="text-uppercase font-weight-bold">
                    <a href="/"><span style="color: white!important;">TIENDA</span></a>
                </h6>
            </div>
            <div class="col-md-2 mb-3 text-center">
                <h6 class="text-uppercase font-weight-bold">
                    <a href="/scanner/scanner"><span style="color: white!important;">SCANNER</span></a>
                </h6>
            </div>
            <div class="col-md-2 mb-3 text-center">
                <h6 class="text-uppercase font-weight-bold">
                    <a href="#"><span style="color: white!important;">CALENDARIO</span></a>
                </h6>
            </div>
            <div class="col-md-2 mb-3 text-center">
                <h6 class="text-uppercase font-weight-bold">
                    <a href="#"><span style="color: white!important;">MAPA</span></a>
                </h6>
            </div>
        </div>
        <hr class="rgba-white-light" style="margin: 0 auto;">
        <div class="row d-flex text-center justify-content-center mb-md-0 mb-4">
            <div class="col-md-8 col-12 mt-5 text-center">
                <p style=" font-weight: 600;font-size: 16px; color: white!important;">LO ÚNICO QUE NO PODEMOS RECICLAR ES EL TIEMPO QUE MALGASTAMOS.</p>
            </div>

        </div>
        <hr class="clearfix d-md-none rgba-white-light" style="margin: 10% 15% 5%;">


    </div>
    <div class=" text-center py-3" style="color: white!important;">© 2020 Copyright:
        RecyClud.com
    </div>
</footer>

    </body>
</html>
